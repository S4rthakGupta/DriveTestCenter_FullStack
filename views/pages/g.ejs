<!-- This below line will include (EJS Template) all the HTML as well as the BOOTSTRAP in this page. -->
<%- include('../layout') %>

<div class="container g-page-container">
  <h1 class="text-center mb-4">You can retrieve or update your data.</h1>

  <!-- If else block to check if the user data is available before the page gets rendered. -->
  <% if (user) { %>
    <% if (message) { %>
      <div class="alert alert-success" role="alert">
        <%= message %>
      </div>
    <% } %>

    <div class="row">
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title text-center mb-3">User Details</h2>
            <p class="card-text"><strong>First Name:</strong> <%= user.firstName %></p>
            <p class="card-text"><strong>Last Name:</strong> <%= user.lastName %></p>
            <p class="card-text"><strong>Age:</strong> <%= user.age %></p>
            <p class="card-text"><strong>License Number:</strong> <%= user.licenseNumber %></p>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title text-center mb-3">Car Details</h2>
            <!-- This if block will check if car details are available. -->
            <% if (user.carDetails) { %>
              <p class="card-text"><strong>Make:</strong> <%= user.carDetails.make %></p>
              <p class="card-text"><strong>Model:</strong> <%= user.carDetails.model %></p>
              <p class="card-text"><strong>Year:</strong> <%= user.carDetails.year %></p>
              <p class="card-text"><strong>Plate Number:</strong> <%= user.carDetails.plateNumber %></p>
            <% } else { %>
              <!-- It will display this message if no car details are available. -->
              <p class="card-text">No car details available.</p>
            <% } %>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body">
            <h2 class="card-title text-center mb-3">Appointment Details</h2>
            <p class="card-text">
              <strong>Date:</strong>              
              <!-- This below code will check if appointment date is available and will format it -->
              <% if (user.appointment && user.appointment.date) { %>
                <%= new Date(user.appointment.date).toISOString().split('T')[0] %>
              <% } else { %>
                <!-- It will display N/A if appointment dates are not available. (Not added through Admin UserType) -->
                N/A
              <% } %>
            </p>
            <p class="card-text">
              <strong>Time:</strong>
              <!-- This below line will check if appointment time is available -->
              <% if (user.appointment && user.appointment.time) { %>
                <%= user.appointment.time %>
              <% } else { %>                
                <!-- It will display N/A if no appointment time is available -->
                N/A
              <% } %>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- This below is for updating the Car information. -->
    <% if (hasPersonalInfo) { %>
      <div class="section mt-4">
        <form id="updateForm" action="/saveUserData" method="POST">
          <div class="card mb-4">
            <div class="card-body">
              <h2 class="card-title text-center mb-3">Car Information (Editable)</h2>
              <div class="form-group">
                <label for="carMake">Make:</label>
                <input type="text" id="carMake" name="carMake" value="<%= user.carDetails ? user.carDetails.make : '' %>" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="carModel">Model:</label>
                <input type="text" id="carModel" name="carModel" value="<%= user.carDetails ? user.carDetails.model : '' %>" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="carYear">Year:</label>
                <input type="number" id="carYear" name="carYear" value="<%= user.carDetails ? user.carDetails.year : '' %>" class="form-control" required>
              </div>
              <div class="form-group">
                <label for="plateNumber">Plate Number:</label>
                <input type="text" id="plateNumber" name="plateNumber" value="<%= user.carDetails ? user.carDetails.plateNumber : '' %>" class="form-control" required>
              </div>
                <input type="text" id="testType" name="testType" value="G" class="form-control" style="visibility: hidden;">
              <button type="submit" class="btn btn-primary btn-block">Update Car Information</button>
            </div>
          </div>
        </form>
      </div>
    <% } else { %>      
      <div class="alert alert-warning mt-4">
      <!-- It will display a warning message if personal information is not available. -->
        <p>Please update your personal information to be able to change your appointment.</p>
      </div>
    <% } %>
  <% } %>
</div>